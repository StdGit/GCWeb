!function(z,e,D,l){"use strict";function I(e,t){var a=this,o=[];return this.map=e,this.settings=t,this.id=this.settings.tableId?this.settings.tableId:R(),this.layer=this.createOLLayer(),this.settings.accessible=void 0===this.settings.accessible||this.settings.accessible,this.settings.visible=void 0===this.settings.visible||this.settings.visible,this.settings.zoom=void 0===this.settings.zoom||this.settings.zoom,this.settings.accessible&&this.map.layerDiv.append("<div class='panel panel-default'><div class='panel-heading'><div class='panel-title' role='heading'>"+this.settings.title+"</div></div><div class='panel-body'><div data-layer='"+this.id+"' class='geomap-table-wrapper' style='display:none;'></div></div></div>"),Object.defineProperty(a,"isVisible",{get:function(){return a.visibilityState},set:function(t){a.visibilityState=t,o.forEach(function(e){return e(t)})}}),a.layer?(this.observeVisibility=function(e){o.push(e)},this.observeVisibility(function(e){var t=z("div[ data-layer='"+a.id+"' ].geomap-table-wrapper");e?(t.fadeIn(),t.parent().find(".layer-msg").remove()):(t.fadeOut(),t.parent().append("<div class='layer-msg'><p>"+B.hiddenLayer+"</p></div>").fadeIn()),a.layer.setVisible(a.isVisible)}),0!==this.map.legendDiv.length&&this.addToLegend(),this.isVisible=this.settings.visible,this):null}function c(e,t){var a;return e.getInteractions().forEach(function(e){e instanceof t&&(a=e)}),a}function G(){var e={fill:P(l.drawColours[t],.5),stroke:P(l.drawColours[t],1),transparent:[0,0,0,0]};return(t+=1)===l.drawColours.length&&(t=0),e}function g(){var s,p,c,g,d,a,u,m,h,y,b,f,v=G();this.createStyleFunction=function(e,t){return t=t,a=(d=e)&&d.type?d.type:"default",function(e){return"rule"===a?new o(e,t):"symbol"===a?new i:"default"===a?new r(e,t):"unique"===a?new l(e,t):"select"===a?new n(e,t):void 0}};var o=function(e){for(var t,a,o=d.rule,i=o.length,r={EQUAL_TO:function(e,t){return String(e)===String(t[0])},GREATER_THAN:function(e,t){return e>t[0]},LESS_THAN:function(e,t){return e<t[0]},BETWEEN:function(e,t){return e>=t[0]&&e<=t[1]}},l=e&&e.getGeometry()?e.getGeometry().getType():"Polygon",n=0;n!==i;n+=1)if(a=(t=o[n]).filter,b=t.init.strokeDash?t.init.strokeDash:[1,0],f=t.init.strokeWidth?t.init.strokeWidth:1,m=t.init.fillOpacity?t.init.fillOpacity:t.init.graphicOpacity?t.init.graphicOpacity:.5,h=t.init.pointRadius?t.init.pointRadius:5,y=t.init.strokeColor?P(t.init.strokeColor,m):v.transparent,u=P(t.init.fillColor,m),g=t.init.graphicName?t.init.graphicName:null,s=t.init.externalGraphic?t.init.externalGraphic:null,p=t.init.graphicHeight?t.init.graphicHeight:25,c=t.init.graphicWidth?t.init.graphicWidth:25,r[a](e.attributes[t.field],t.value))switch(l){case"Polygon":return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});case"Point":return g?S({symbol:g,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,lineDash:b}),radius:h}):s?k({src:s,opacity:m,size:[c,p]}):C({radius:h,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});case"LineString":return T({stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});default:return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})})}},i=function(){return m=d.init.fillOpacity?d.init.fillOpacity:d.init.graphicOpacity?d.init.graphicOpacity:1,h=d.init.pointRadius?d.init.pointRadius:5,y=d.init.strokeColor?P(d.init.strokeColor,m):v.transparent,u=P(d.init.fillColor,m),g=d.init.graphicName?d.init.graphicName:null,s=d.init.externalGraphic?d.init.externalGraphic:null,p=d.init.graphicHeight?d.init.graphicHeight:25,c=d.init.graphicWidth?d.init.graphicWidth:25,g?S({symbol:d.init.graphicName,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,lineDash:b}),radius:h}):s?k({src:s,opacity:m,size:[c,p]}):C({radius:h,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f})})},r=function(){return m=d.fillOpacity?d.fillOpacity:d.graphicOpacity?d.graphicOpacity:1,u=d.fillColor?P(d.fillColor,m):v.transparent,y=d.strokeColor?P(d.strokeColor,m):v.transparent,f=d.strokeWidth?d.strokeWidth:1,b=d.strokeDash?d.strokeDash:[1,0],[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b}),radius:5}),fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})})]},l=function(e,t){var a,o,i=d.field;for(a in d.init)switch(o=d.init[a],b=o.strokeDash?o.strokeDash:[1,0],f=o.strokeWidth?o.strokeWidth:1,m=o.fillOpacity?o.fillOpacity:o.graphicOpacity?o.graphicOpacity:.5,h=o.pointRadius?o.pointRadius:5,y=o.strokeColor?P(o.strokeColor,m):v.transparent,u=o.fillColor?P(o.fillColor,m):null,name=o.name?o.name:null,p=o.graphicHeight?o.graphicHeight:25,s=o.externalGraphic,c=o.graphicWidth?o.graphicWidth:25,t){case"Polygon":if(e.attributes&&e.attributes[i]===a)return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});break;case"Point":if(s){if(e.attributes&&e.attributes[i]===a)return k({src:s,opacity:m,size:[c,p]})}else if(e.attributes&&e.attributes[i]===a)return C({radius:h,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});break;case"LineString":if(e.attributes&&e.attributes[i]===a)return T({stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});break;default:if(e.attributes&&e.attributes[i]===a)return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})})}},n=function(e,t){switch(b=d.strokeDash?d.strokeDash:[1,0],f=d.strokeWidth?d.strokeWidth:1,m=d.fillOpacity?d.fillOpacity:d.graphicOpacity?d.graphicOpacity:.5,h=d.pointRadius?d.pointRadius:5,y=d.strokeColor?P(d.strokeColor,m):v.transparent,u=d.fillColor?P(d.fillColor,m):null,name=d.name?d.name:null,p=d.graphicHeight?d.graphicHeight:25,s=d.externalGraphic,c=d.graphicWidth?d.graphicWidth:25,t){case"Polygon":return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});case"Point":return s?k({src:s,opacity:m,size:[c,p]}):C({radius:h,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});case"LineString":return T({stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})});default:return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:y,width:f,lineDash:b})})}}}function j(e,t){return"<td><label class='wb-inv' for='cb_"+t.getId()+"'>"+B.labelSelect+"</label><input type='checkbox' id='cb_"+t.getId()+"' class='geomap-cbx' data-map='"+e.map.id+"' data-layer='"+t.layerId+"' data-feature='"+t.getId()+"' /></td>"}function V(e,t){return"<td class='text-right'><a href='javascript:;' data-map='"+e.map.id+"' data-layer='"+t.layerId+"' data-feature='"+t.getId()+"' class='btn btn-link geomap-zoomto' alt='"+B.zoomFeature+"' role='button'><span class='glyphicon glyphicon-zoom-in'></span></a></td>"}function s(e,t,a){if(t){var o=a.getOverlays().getArray()[0],i=z(D.getElementById("popup-geomap-map-"+a.id)),r="",l=N(a,t.layerId);if(t&&t.attributes){var n,s,p=t.getGeometry(),c="Point"===p.getType()?p.getCoordinates():event.mapBrowserEvent.coordinate,g=t.attributes;if(l.popupsInfo)for(n in r+=l.popupsInfo.content,g)g.hasOwnProperty(n)&&(s=new RegExp("_"+n,"igm"),r=r.replace(s,g[n]));else for(n in g)g.hasOwnProperty(n)&&(r+="<tr><th><strong>"+n+"</strong></th><td> "+g[n]+"</td></tr>");i.find(".popup-content").html("<h5>"+t.layerTitle+"</h5><table style='width:100%;'>"+r+"</table>"),o.setPosition(c)}else o.setPosition(void 0)}}function p(n){var e,t,a,o,i,r,l=new ol.interaction.DragBox,s=new ol.proj.Projection({code:"EPSG:4326"}),p=n.map.getView().getProjection();l.on("boxend",function(){var e=l.getGeometry().transform(p,s).getExtent();r=A(n,e),n.map.getView().fit(r.getGeometry().getExtent(),n.map.getSize()),z("#geomap-aoi-minx-"+n.id).val(e[0]),z("#geomap-aoi-maxx-"+n.id).val(e[2]),z("#geomap-aoi-maxy-"+n.id).val(e[3]),z("#geomap-aoi-miny-"+n.id).val(e[1]),z("#geomap-aoi-extent-"+n.id).val(r.getGeometry().getExtent()).trigger("change"),z("#geomap-aoi-extent-lonlat-"+n.id).val(e[0]+", "+e[1]+", "+e[2]+", "+e[3]).trigger("change")}),l.on("boxstart",function(){N(n.map,"locLayer").getSource().clear(!0)}),n.map.addInteraction(l),l.setActive(!1),n.settings.useAOIOpen?n.mapDiv.before("<div class='geomap-aoi panel panel-default'><div id='geomap-aoi-"+n.id+"' class='panel-body'></div></div>"):n.mapDiv.before("<details class='geomap-aoi'><summary>"+B.aoiTitle+"</summary><div id='geomap-aoi-"+n.id+"'></div></details>"),z("#geomap-aoi-"+n.id).append("<fieldset id='form-aoi-"+n.id+"'><legend tabindex='-1'>"+B.aoiInstructions+"</legend><div class='row'><div class='col-md-2 form-group'><label for='geomap-aoi-maxy-"+n.id+"' class='wb-inv'>"+B.aoiNorth+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+B.aoiNorth.charAt(0)+"</span><input type='number' id='geomap-aoi-maxy-"+n.id+"' placeholder='90' class='form-control input-sm' min='-90' max='90' step='0.000001'></input></div></div><div class='col-md-2 form-group'><label for='geomap-aoi-maxx-"+n.id+"' class='wb-inv'>"+B.aoiEast+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+B.aoiEast.charAt(0)+"</span><input type='number' id='geomap-aoi-maxx-"+n.id+"' placeholder='180' class='form-control input-sm' min='-180' max='180' step='0.000001'></input> </div></div><div class='col-md-2 form-group'><label for='geomap-aoi-miny-"+n.id+"' class='wb-inv'>"+B.aoiSouth+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+B.aoiSouth.charAt(0)+"</span><input type='number' id='geomap-aoi-miny-"+n.id+"' placeholder='-90' class='form-control input-sm' min='-90' max='90' step='0.000001'></input> </div></div><div class='col-md-2 form-group'><label for='geomap-aoi-minx-"+n.id+"' class='wb-inv'>"+B.aoiWest+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+B.aoiWest.charAt(0)+"</span><input type='number' id='geomap-aoi-minx-"+n.id+"' placeholder='-180' class='form-control input-sm' min='-180' max='180' step='0.000001'></input> </div></div><div class='col-md-4'><button class='btn btn-default btn-sm' id='geomap-aoi-btn-draw-"+n.id+"'>"+B.add+"</button> <button class='btn btn-default btn-sm' id='geomap-aoi-btn-clear-"+n.id+"'>"+B.aoiBtnClear+"</button> </div></div><input type='hidden' id='geomap-aoi-extent-"+n.id+"'></input><input type='hidden' id='geomap-aoi-extent-lonlat-"+n.id+"'></input></fieldset>"),z("#geomap-aoi-btn-clear-"+n.id).after("<button id='geomap-aoi-toggle-mode-draw-"+n.id+"' href='#' class='btn btn-sm btn-default geomap-geoloc-aoi-btn' title='"+B.aoiBtnDraw+"'><i class='glyphicon glyphicon-edit'></i> "+B.aoiBtnDraw+"</button>"),w.on("click","#geomap-aoi-toggle-mode-draw-"+n.id,function(e){e.preventDefault();var t=c(n.map,ol.interaction.DragBox),a=c(n.map,ol.interaction.Select),o=l.getActive(),i=z("#geomap-aoi-"+n.id);z(this).toggleClass("active"),o||i.find("legend").trigger("setfocus.wb"),t.setActive(!o),a.setActive(o)}),w.on("click","#geomap-aoi-btn-clear-"+n.id,function(e){e.preventDefault(),z("#geomap-aoi-extent-"+n.id).val(""),z("#geomap-aoi-extent-lonlat-"+n.id).val(""),z("#geomap-aoi-minx-"+n.id).val("").parent().removeClass("has-error"),z("#geomap-aoi-miny-"+n.id).val("").parent().removeClass("has-error"),z("#geomap-aoi-maxx-"+n.id).val("").parent().removeClass("has-error"),z("#geomap-aoi-maxy-"+n.id).val("").parent().removeClass("has-error"),N(n.map,"locLayer").getSource().clear(!0)}),w.on("click","#geomap-aoi-btn-draw-"+n.id,function(e){e.preventDefault(),z("#geomap-aoi-extent-"+n.id).val(""),z("#geomap-aoi-extent-lonlat-"+n.id).val(""),z("#geomap-aoi-minx-"+n.id).parent().removeClass("has-error"),z("#geomap-aoi-maxx-"+n.id).parent().removeClass("has-error"),z("#geomap-aoi-maxy-"+n.id).parent().removeClass("has-error"),z("#geomap-aoi-miny-"+n.id).parent().removeClass("has-error"),N(n.map,"locLayer").getSource().clear(!0);var t,a=parseFloat(z("#geomap-aoi-minx-"+n.id).val()),o=parseFloat(z("#geomap-aoi-miny-"+n.id).val()),i=parseFloat(z("#geomap-aoi-maxx-"+n.id).val()),r=parseFloat(z("#geomap-aoi-maxy-"+n.id).val()),l=!0;if((!a||a<-180||180<a)&&(z("#geomap-aoi-minx-"+n.id).parent().addClass("has-error"),l=!1),(!i||i<-180||180<i)&&(z("#geomap-aoi-maxx-"+n.id).parent().addClass("has-error"),l=!1),(!r||r<-90||90<r)&&(z("#geomap-aoi-maxy-"+n.id).parent().addClass("has-error"),l=!1),(!o||o<-90||90<o)&&(z("#geomap-aoi-miny-"+n.id).parent().addClass("has-error"),l=!1),!1===l)return!1;t=A(n,[a,o,i,r]),n.map.getView().fit(t.getGeometry().getExtent(),n.map.getSize()),z("#geomap-aoi-extent-"+n.id).val(t.getGeometry().getExtent()).trigger("change"),z("#geomap-aoi-extent-lonlat-"+n.id).val(a+", "+o+", "+i+", "+r).trigger("change")}),n.aoiExtent&&(t=(e=n.aoiExtent.split(","))[0].trim(),a=e[1].trim(),o=e[2].trim(),i=e[3].trim(),r=A(n,e),n.map.getView().fit(r.getGeometry().getExtent(),n.map.getSize()),z("#geomap-aoi-minx-"+n.id).val(t),z("#geomap-aoi-maxx-"+n.id).val(o),z("#geomap-aoi-maxy-"+n.id).val(i),z("#geomap-aoi-miny-"+n.id).val(a),z("#geomap-aoi-extent-"+n.id).val(r.getBounds().toBBOX()),z("#geomap-aoi-extent-lonlat-"+n.id).val(t+", "+a+", "+o+", "+i))}function o(p){var e=D.createElement("button"),t=D.createElement("div");e.innerHTML="?",e.title=B.accessTitle,e.addEventListener("click",function(){var e=D.createElement("div"),t=D.createElement("header"),a=D.createElement("h3"),o=D.createElement("a"),i=D.createElement("div"),r=D.createAttribute("role"),l=D.createAttribute("title"),n=D.createAttribute("href");e.className="panel panel-default geomap-help-dialog ol-control ",t.className="panel-heading",a.innerHTML=B.accessTitle,a.className="panel-title",t.appendChild(a),l.value=B.dismiss,o.setAttributeNode(l),n.value="#",o.setAttributeNode(n),r.value="button",o.setAttributeNode(r),o.innerHTML="&#xd7;<span class='wb-inv'>"+B.dismiss+"</span>",o.className="btn btn-link",e.appendChild(o),i.innerHTML="<p>"+B.access+"</p>",i.className="panel-body",e.appendChild(t),e.appendChild(i);var s=new ol.control.Control({element:e});o.addEventListener("click",function(e){e.preventDefault(),z(e.target).closest(".geomap-help-dialog").fadeOut(function(){p.map.removeControl(s)})}),p.map.addControl(s)},!1),t.className="geomap-help-btn ol-unselectable ol-control",t.appendChild(e),ol.control.Control.call(this,{element:t}),p.map.addControl(this)}function d(u){var e,t,a=D.createElement("div"),m="setfocus.wb",o=B.geoLocationURL,h={quebec:"<abbr title='Quebec'>QC</abbr>","québec":"<abbr title='Québec'>QC</abbr>","british columbia":"<abbr title='British Columbia'>BC</abbr>","colombie-britannique":"<abbr title='Colombie-Britannique'>BC</abbr>",alberta:"<abbr title='Alberta'>AB</abbr>",saskatchewan:"<abbr title='Saskatchewan'>SK</abbr>",manitoba:"<abbr title='Manitoba'>MB</abbr>",ontario:"<abbr title='Ontario'>ON</abbr>","newfoundland and labrador":"<abbr title='Newfoundland and Labrador'>NL</abbr>","terre-neuve-et-labrador":"<abbr title='Terre-Neuve-et-Labrador'>NL</abbr>","prince edward island":"<abbr title='Prince Edward Island'>PE</abbr>","île-du-prince-édouard":"<abbr title='Île-du-prince-Édouard'>PE</abbr>","nova scotia":"<abbr title='Nova Scotia'>NS</abbr>","nouvelle-écosse":"<abbr title='Nouvelle-Écosse'>NS</abbr>","new brunswick":"<abbr title='New Brunswick'>NB</abbr>","nouveau-brunswick":"<abbr title='Nouveau-Brunswick'>NB</abbr>",yukon:"<abbr title='Yukon'>YT</abbr>","northwest territories":"<abbr title='Northwest Territories'>NT</abbr>","territoires du nord-ouest":"<abbr title='Territoires du Nord-Ouest'>NT</abbr>",nunavut:"<abbr title='Nunavut'>NU</abbr>"},y={"ca.gc.nrcan.geoloc.data.model.Street":"<span class='glyphicon glyphicon-road' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.Intersection":"<span class='glyphicon glyphicon-road' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.Geoname":"<span class='glyphicon glyphicon-map-marker' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.PostalCode":"<span class='glyphicon glyphicon-envelope' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.NTS":"<span class='glyphicon glyphicon-globe' aria-hidden='true'></span>"};function b(e,t){var a,o,i,r,l,n=[],s=new ol.proj.Projection({code:"EPSG:4326"}),p=u.map.getView().getProjection();if(N(u.map,"locLayer").getSource().clear(!0),e&&void 0!==e){for(a=e.split(","),r=(o=_(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))).length-1;-1!==r;r-=1)n.push([o[r].getCoordinates()[0],o[r].getCoordinates()[1]]);i=new ol.Feature({geometry:new ol.geom.Polygon([n]).transform(s,p)}),N(u.map,"locLayer").getSource().addFeature(i),u.map.getView().fit(i.getGeometry().getExtent(),u.map.getSize())}else t&&void 0!==t&&(l=0===u.map.getView().getZoom()?12:u.map.getView().getZoom(),i=new ol.Feature({geometry:new ol.geom.Point(t.split(",")).transform(s,p)}),N(u.map,"locLayer").getSource().addFeature(i),u.map.getView().setZoom(l),u.map.getView().setCenter(i.getGeometry().getCoordinates()))}function f(e){var t=e.nextSibling.firstChild;c(u.map,ol.interaction.KeyboardPan).setActive(!0),t.className+=" hide",t.innerHTML="",t.setAttribute("aria-hidden","true"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-activedescendent","")}function v(e,t){function p(e,t){var a=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(a,function(e){return t[e.toLowerCase()]})}var c="",g=z("#wb-geomap-geocode-search-"+u.id),d=z("#wb-geomap-geoloc-al-"+u.id);(!t||t.length<3)&&d.empty(),z.ajax({type:"GET",url:o,data:{q:t+"*"},success:function(e){if(0<e.length){var t,a,o,i,r,l,n=e.length,s="";for(t=0;t!==n;t+=1)i=(a=e[t]).title.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=a.bbox?a.bbox[0]+", "+a.bbox[1]+", "+a.bbox[2]+", "+a.bbox[3]:"",l=a.geometry&&"Point"===a.geometry.type?a.geometry.coordinates[0]+", "+a.geometry.coordinates[1]:"",s=y[a.type]?y[a.type]:"<span class='glyphicon glyphicon-map-marker' aria-hidden='true'></span>",o=(i=p(i,h)).replace(/<(?:.|\n)*?>/gm,""),c+="<li id='al-opt-"+u.id+"-"+t+"' class='al-opt' data-lat-lon='"+l+"' data-bbox='"+r+"' data-type='"+a.type+"'><a href='javascript:;' tabindex='-1'>"+s+"<span class='al-val'>"+i+"</span><span class='al-lbl wb-inv' aria-hidden='true'>"+o+"</span></a></li>";d.empty().append(c),d.removeClass("hide").attr("aria-hidden","false"),g.attr("aria-expanded","true"),z(".al-opt a").on("keydown click vclick",function(e){var t=e.target,a=e.type,o=e.which;switch(a){case"keydown":if(!e.ctrlKey&&!e.metaKey)return function(e,t){var a,o,i,r,l,n=t.parentNode.parentNode,s=n.parentNode.previousSibling,p=z(s);if(!(event.ctrlKey||event.altKey||event.metaKey)){if(32===e||47<e&&e<91||95<e&&e<112||159<e&&e<177||187<e&&e<223)return s.value+=String.fromCharCode(e),p.trigger(m),v(s,s.value),!1;if(8===e)return i=s.value,0!==(r=i.length)&&(s.value=i.substring(0,r-1),v(s,s.value)),p.trigger(m),!1;if(13===e)return a=t.getElementsByTagName("span"),i=a[2].innerHTML,s.value=i,b(t.parentNode.getAttribute("data-bbox"),t.parentNode.getAttribute("data-lat-lon")),p.trigger(m),f(s),!1;if(9===e||27===e)return p.trigger(m),f(s),!1;if(38===e||40===e)return 38===e?(o=t.parentNode.previousSibling)||(l=n.getElementsByTagName("li"),o=l[l.length-1]):o=(o=t.parentNode.nextSibling)||n.getElementsByTagName("li")[0],o=o.getElementsByTagName("a")[0],s.setAttribute("aria-activedescendent",o.parentNode.getAttribute("id")),z(o).trigger(m),!1}}(o,t);break;case"click":case"vclick":case"touchstart":if(!o||1===o)return function(e){var t="a"===e.nodeName.toLowerCase()?e:e.parentNode,a=t.parentNode.parentNode.parentNode.previousSibling,o=z(a),i=t.getElementsByTagName("span")[2].innerHTML;return a.value=i,b(t.parentNode.getAttribute("data-bbox"),t.parentNode.getAttribute("data-lat-lon")),o.trigger(m),f(a),!1}(t)}})}else d.empty(),d.addClass("hide").attr("aria-hidden","true"),d.attr("aria-expanded","false")},dataType:l.ielt10?"jsonp":"json",cache:!1})}a.innerHTML="<label for='wb-geomap-geocode-search-"+u.id+"' class='wb-inv'>"+B.geoCoderLabel+"</label><input type='text' class='form-control' id='wb-geomap-geocode-search-"+u.id+"' placeholder='"+B.geoCoderPlaceholder+"' ></input><div class='wb-geomap-geoloc-al-cnt'><ul role='listbox' id='wb-geomap-geoloc-al-"+u.id+"' class='wb-geomap-geoloc-al hide' aria-hidden='true' aria-live='polite'></ul></div>",a.className="geomap-geoloc ol-unselectable ol-control",ol.control.Control.call(this,{element:a}),u.map.addControl(this),z("#wb-geomap-geocode-search-"+u.id).attr("autocomplete","off"),z("#wb-geomap-geocode-search-"+u.id).attr("role","textbox"),z("#wb-geomap-geocode-search-"+u.id).attr("aria-haspopup","true"),z("#wb-geomap-geocode-search-"+u.id).attr("aria-autocomplete","list"),z("#wb-geomap-geocode-search-"+u.id).attr("aria-owns","wb-geomap-geoloc-al-"+u.id),z("#wb-geomap-geocode-search-"+u.id).attr("aria-activedescendent",""),t=768<(e=parseFloat(z(".geomap-geoloc").parent().width()))?.6:.8,x?(z(".geomap-geoloc").css({width:e-10+"px"}),z(".wb-geomap-geoloc-al-cnt").css({width:e-10+"px"})):(z(".geomap-geoloc").css({width:e*t}),z(".wb-geomap-geoloc-al-cnt").css({width:e*t})),w.on("keydown","#wb-geomap-geocode-search-"+u.id,function(e){c(u.map,ol.interaction.KeyboardPan).setActive(!1);var t=e.which;if(!e.ctrlKey&&!e.metaKey)return function(e,t){var a,o,i,r,l=t.target,n=l.nextSibling.firstChild,s=-1!==n.className.indexOf("hide");if(!(t.ctrlKey||t.altKey||t.metaKey))if(32===e||47<e&&e<91||95<e&&e<112||159<e&&e<177||187<e&&e<223)t.altKey||v(l,l.value+String.fromCharCode(e));else if(8!==e||t.altKey){if((38===e||40===e)&&""===l.getAttribute("aria-activedescendent"))return s&&v(l),0===(a=n.getElementsByTagName("a")).length||(o=a[38===e?a.length-1:0],l.setAttribute("aria-activedescendent",o.parentNode.getAttribute("id")),z(o).trigger(m)),!1;s||9!==e&&27!==e&&(27!==e||t.altKey)||f(l)}else i=l.value,0!==(r=i.length)&&v(l,i.substring(0,r-1))}(t,e)})}function u(e){var t,a,o,i,r,l=e||{},n=this;function s(){return a=new ol.Feature,t=new ol.Feature,a.setStyle(C({radius:6,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})),[t,a]}z("body").append("<section id='overlay-location-error' class='wb-overlay modal-content overlay-def wb-bar-t bg-danger'><header><h2 class='modal-title'>Geolocation error.</h2></header></section>"),z("#overlay-location-error").trigger("wb-init.wb-overlay"),(o=D.createElement("button")).setAttribute("type","button"),o.setAttribute("title",B.geolocBtn),o.innerHTML="<span class='glyphicon glyphicon-screenshot'></span>",(r=D.createElement("div")).className="ol-geolocate ol-unselectable ol-control",r.appendChild(o),n.geolocation=new ol.Geolocation(l),ol.control.Control.call(this,{element:r,target:l.target}),n.geolocation.on("change:accuracyGeometry",function(){t.setGeometry(n.geolocation.getAccuracyGeometry())}),n.geolocation.on("change:position",function(){i=n.geolocation.getPosition(),a.setGeometry(i?new ol.geom.Point(i):null);var e=n.featuresOverlay.getSource().getExtent();n.getMap().getView().fit(e,n.getMap().getSize()),z(o).html("<span style='color:#3399CC;' class='glyphicon glyphicon-screenshot'></span>")}),n.geolocation.on("error",function(e){2===e.code?z("#overlay-location-error h2.modal-title").text(B.geolocUncapable):z("#overlay-location-error h2.modal-title").text(B.geolocFail),z("#overlay-location-error").trigger("open.wb-overlay")}),o.addEventListener("click",function(){z(this).html("<span style='font-size:.9em;' class='glyphicon glyphicon-refresh glyphicon-spin'></span>"),void 0===n.featuresOverlay?(n.featuresOverlay=new ol.layer.Vector({map:n.getMap(),source:new ol.source.Vector({})}),n.featuresOverlay.getSource().addFeatures(s()),n.geolocation.setTracking(!0)):0===n.featuresOverlay.getSource().getFeatures().length?(n.featuresOverlay.getSource().addFeatures(s()),n.geolocation.setTracking(!0)):(n.geolocation.setTracking(!1),n.featuresOverlay.getSource().clear(),z(this).html("<span class='glyphicon glyphicon-screenshot'></span>"))},!1)}function m(e){var t,a=L(e.getAttribute("data-map"));return e.getAttribute("data-layer")?(t=N(a.map,e.getAttribute("data-layer")),[a.map,t,e.getAttribute("data-feature")?t.getSource().getFeatureById(e.getAttribute("data-feature")):null]):[a.map,null,null]}var n,B,r,h="wb-geomap",y="."+h,w=l.doc,t=0,b=[],x=!1,f={overlays:[],tables:[],useScaleLine:!1,useMousePosition:!1,useLegend:!1,useMapControls:!0,useGeocoder:!1,useGeolocation:!1,useAOI:!1},v=function(e){var t,a=e.target;this.id=a.attr("id"),this.mapLayers=[],this.layerDiv=a.find(".wb-geomap-layers").attr("id","geomap-layers-"+this.id),this.legendDiv=a.find(".wb-geomap-legend").attr("id","geomap-legend-"+this.id),this.mapDiv=a.find(".wb-geomap-map").attr("id","geomap-map-"+this.id),this.settings=e.settings,this.settings.aspectRatio=this.settings.basemap&&this.settings.basemap.mapOptions&&void 0!==this.settings.basemap.mapOptions.aspectRatio?this.settings.basemap.mapOptions.aspectRatio:.8,this.map=E(this),this.legend=new i(this),t=this.addBasemap(),this.map.setView(new ol.View(t)),this.addMapLayers(),t.extent&&this.map.getView().fit(t.extent,this.map.getSize());var r=this.mapLayers;this.map.getLayersByName=function(e){var t,a,o=r.length,i={popup:{visible:function(){return!0}},geometry:{bounds:ol.proj.transform(this.getOverlays().getArray()[0].getPosition(),"EPSG:3978","EPSG:4326")}};for(t=0;t!==o;t+=1)if((a=r[t]).id&&a.id===e)return[{features:[i]}]},this.loadControls(),this.accessibilize(),this.createPopup(),w.on("wb-ready.wb-geomap","#"+this.id,function(){z("#"+this.id).find(".geomap-progress").remove()})},i=function(e){return this.map=e,this.symbolMapArray=[],this.target=z("#"+e.id+".wb-geomap").find(".wb-geomap-legend"),this.target.attr("id","geomap-legend-"+e.id),this.target.empty(),this},S=function(e){return{square:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:4,radius:e.radius,angle:Math.PI/4})})],triangle:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:3,radius:e.radius,rotation:Math.PI/4,angle:0})})],star:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:5,radius:e.radius,radius2:.4*e.radius,angle:0})})],cross:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:4,radius:e.radius,radius2:0,angle:0})})],x:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:4,radius:e.radius,radius2:0,angle:Math.PI/4})})]}[e.symbol]},k=function(e){return[new ol.style.Style({image:new ol.style.Icon({opacity:e.opacity,src:e.src,size:e.size})})]},C=function(e){return[new ol.style.Style({image:new ol.style.Circle({radius:e.radius,fill:e.fill,stroke:e.stroke})})]},O=function(e){return[new ol.style.Style({fill:e.fill,stroke:e.stroke})]},T=function(e){return[new ol.style.Style({stroke:e.stroke})]},P=function(e,t){var a=(e+"").trim(),o=null,i=a.match(/^#?(([0-9a-zA-Z]{3}){1,3})$/),r=t||1;return i?(6===(a=i[1]).length?o=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16),r]:3===a.length&&(o=[parseInt(a.substring(0,1)+a.substring(0,1),16),parseInt(a.substring(1,2)+a.substring(1,2),16),parseInt(a.substring(2,3)+a.substring(2,3),16),r]),o):e},E=function(o){var e,t=o.settings.useMapControls?ol.control.defaults({attributionOptions:{collapsible:!1}}):[],a=o.settings.useMapControls?ol.interaction.defaults({mouseWheelZoom:!0}):[];proj4.defs("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"),proj4.defs("urn:ogc:def:crs:OGC:1.3:CRS84",proj4.defs("EPSG:4326"));var i=new ol.Map({controls:t,interactions:a,logo:!1,target:o.mapDiv.attr("id")});e=c(i,ol.interaction.MouseWheelZoom),o.settings.useMapControls&&e&&e.setActive(!1),o.mapDiv.height(o.mapDiv.width()*o.settings.aspectRatio),i.set("aspectRatio",o.settings.aspectRatio),i.id=o.id,i.once("postrender",function(){i.getLayer=function(e){var t,a,o=D.querySelector(e+" [data-geometry][data-type]"),i=o.dataset.geometry;return"wkt"===o.dataset.type&&-1!==i.indexOf("POINT")&&(i=(i=(i=i.replace(/,/,"")).substring(i.indexOf("(")+1,i.indexOf(")"))).split(" "),t=parseFloat(i[0]),a=parseFloat(i[1])),{getDataExtent:function(){return[t,a]}}},i.zoomToExtent=function(e){i.getView().setCenter(ol.proj.transform([e[0],e[1]],"EPSG:4326","EPSG:3978")),i.getView().setZoom(5)},l.ready(z("#"+o.id),h,[i])}),i.on("moveend",function(){z(o.id).trigger("wb-updated"+y,[o.map])}),o.mapDiv.append("<div id='tooltip_"+o.id+"' style='display:none;'><span class='tooltip-txt'></span></div>");return i.on("pointermove",function(e){r=z("#tooltip_"+o.id),e.dragging?r.hide():function(e){r=z("#tooltip_"+o.id);var t,a=z("#tooltip_"+o.id+" span.tooltip-txt");r.css({left:e[0]+"px",top:e[1]-15+"px",position:"absolute"}),(t=i.forEachFeatureAtPixel(e,function(e){return e}))&&t.tooltip?(r.hide(),a.html(t.tooltip),r.show()):r.hide()}(i.getEventPixel(e.originalEvent))}),i},L=function(e){var t,a;for(a=b.length-1;-1!==a;a-=1)if((t=b[a]).id===e)return t},A=function(e,t,a){var o,i,r,l=[],n=new ol.proj.Projection({code:"EPSG:4326"}),s=e.map.getView().getProjection();for(i=(o=_(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))).length-1;-1!==i;i-=1)l.push([o[i].getCoordinates()[0],o[i].getCoordinates()[1]]);return r=new ol.Feature({geometry:new ol.geom.Polygon([l]).transform(n,s)}),a||N(e.map,"locLayer").getSource().addFeature(r),r},_=function(e,t,a,o){var i,r=parseFloat(e),l=parseFloat(t),n=parseFloat(a),s=parseFloat(o),p=[];if(0===r.length||0===l.length||0===n.length||0===s.length)return!1;for(-180===r&&(r+=.1),180===n&&(n=-5),90===s&&(s-=3),-90===l&&(l=35),i=r;i<n;i+=.5)p.push(new ol.geom.Point([i,l]));for(p.push(new ol.geom.Point([n,l])),i=n;r<i;i-=.5)p.push(new ol.geom.Point([i,s]));return p.push(new ol.geom.Point([r,s])),p.push(new ol.geom.Point([r,l])),p},N=function(e,t){var a;return e.getLayers().forEach(function(e){t!==e.id||(a=e)}),a},R=function(){return Math.random().toString(36).slice(2)};function F(e){var a;return z.each(e,function(e,t){t.coordinates&&(a=e)}),a}w.on("click",".geomap-zoomto",function(e){var t,a,o,i,r,l=e.which,n="A"===e.target.tagName?e.target:z(e.target).closest("a")[0];l&&1!==l||(e.preventDefault(),t=n.getAttribute("data-map"),i=(o=(a=m(n))[2].getGeometry()).getExtent(),r=a[0].getView(),"Point"===o.getType()?(r.fit(i,a[0].getSize()),r.setZoom(10)):r.fit(i,a[0].getSize()),z("#"+t+" .wb-geomap-map").trigger("setfocus.wb"))}),w.on("geomap.wb",y,function(e){var t,a,o=e.target,i=o.className.split(/\s+/),r={};/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(x=!0),e.currentTarget===o&&(t=z(o),B||(n=l.i18n,B={add:n("add"),close:n("close"),colon:n("colon"),err:n("err"),hiddenLayer:n("geo-hdnlyr"),toggleLayer:n("geo-tgllyr"),labelSelect:n("geo-lblsel"),select:n("geo-sel"),zoomFeature:n("geo-zmfeat"),zoomin:n("geo-zmin"),zoomout:n("geo-zmout"),zoomworld:n("geo-zmwrld"),baseMapTitle:n("geo-bmapttl"),baseMapURL:n("geo-bmap-url"),baseMapMatrixSet:n("geo-bmap-matrix-set"),scaleline:n("geo-sclln"),mouseposition:n("geo-msepos"),access:n("geo-ally"),accessTitle:n("geo-allyttl"),attribLink:n("geo-attrlnk"),attribTitle:n("geo-attrttl"),ariaMap:n("geo-ariamap"),geoLocationURL:n("geo-locurl-geogratis"),geoCoderPlaceholder:n("geo-loc-placeholder"),geoCoderLabel:n("geo-loc-label"),aoiNorth:n("geo-aoi-north"),aoiEast:n("geo-aoi-east"),aoiSouth:n("geo-aoi-south"),aoiWest:n("geo-aoi-west"),aoiInstructions:n("geo-aoi-instructions"),aoiTitle:n("geo-aoi-title"),aoiBtnDraw:n("geo-aoi-btndraw"),aoiBtnClear:n("geo-aoi-btnclear"),aoiBtnClose:n("close"),geolocBtn:n("geo-geoloc-btn"),geolocFail:n("geo-geoloc-fail"),geolocUncapable:n("geo-geoloc-uncapable"),geoLgndGrphc:n("geo-lgnd-grphc"),dismiss:n("dismiss")}),a={useScaleLine:-1!==i.indexOf("scaleline")||void 0,useMousePosition:-1!==i.indexOf("position")||void 0,useLegend:-1!==i.indexOf("legend"),useMapControls:-1===i.indexOf("static"),useGeocoder:-1!==i.indexOf("geocoder"),useGeolocation:-1!==i.indexOf("geolocation"),useAOI:-1!==i.indexOf("aoi"),useAOIOpen:-1!==i.indexOf("aoi-open")},z.extend(r,f,a,l.getData(t,h)),r.layersFile?z.ajax({url:r.layersFile,async:!0,dataType:"script",success:function(){(r=z.extend(r,wet_boew_geomap))&&r.basemap&&r.basemap.type&&"xyz"===r.basemap.type&&(r.basemap.type="osm"),o.geomap=new v({target:t,settings:r}),b.push(o.geomap)}}):(o.geomap=new v({target:t,settings:r}),b.push(o.geomap))),l.getMap=function(e){return L(e)},l.getLayer=function(e,t){return N(e,t)}}),w.on(l.resizeEvents,function(i){b.forEach(function(e){var t=z(e.map.getTargetElement()),a=t.find(".geomap-geoloc"),o=t.width();t.height(o*e.map.get("aspectRatio")),e.map.updateSize(),a&&("mediumview"===i.type||"largeview"===i.type||"xlargeview"===i.type?a.css({width:"60%"}):a.css({width:"80%"}))})}),w.on("change",".geomap-cbx",function(e){var t=e.target,a=m(t)[2],o=m(t)[0],i=c(o,ol.interaction.Select);t.checked?i.getFeatures().push(a):i.getFeatures().remove(a)}),w.on("focusin focusout mouseover mouseout",".wb-geomap-map",function(e){var t=e.currentTarget,a=e.type,o=t.className.indexOf("active"),i=L(t.getAttribute("data-map")),r=c(i.map,ol.interaction.MouseWheelZoom);i.settings.useMapControls&&r.setActive(!1),"mouseover"===a||"focusin"===a?(o&&z(t).addClass("active"),"focusin"===a&&i.settings.useMapControls&&r.setActive(!0)):0<o&&z(t).removeClass("active")}),v.prototype.addBasemap=function(){var e,t,a,o,i,r,l,n,s=this,p=s.settings.basemap,c=p&&0!==p.length,g={},d=[],u={},m=[];if(s.settings.attribution&&(u.attributions=[new ol.Attribution({html:s.settings.attribution.text})]),c)g.extent=p.mapOptions&&p.mapOptions.maxExtent?p.mapOptions.maxExtent.split(",").map(Number):null,g.projection=p.mapOptions&&p.mapOptions.projection?p.mapOptions.projection:"EPSG:3857",g.center=s.settings&&s.settings.center?ol.proj.transform(s.settings.center,"EPSG:4326",g.projection):p.mapOptions&&p.mapOptions.center?ol.proj.transform(p.mapOptions.center,"EPSG:4326",g.projection):p.mapOptions&&p.mapOptions.maxExtent?ol.extent.getCenter(g.extent):[0,0],g.zoom=s.settings&&s.settings.zoom?s.settings.zoom:p.mapOptions&&p.mapOptions.zoomLevel?p.mapOptions.zoomLevel:2,"wms"===p.type?((e=function(e,t){var a,o={};for(a in e)e.hasOwnProperty(a)&&z.inArray(a,t)<0&&(o[a]=e[a]);return o}(p,["mapOptions","url"])).srs=g.projection,e.crs=g.projection,m.push(new ol.layer.Image({extent:g.extent,source:new ol.source.ImageWMS({url:p.url,params:e})}))):"esri"===p.type?(u.url=p.url.replace("/MapServer/export","/MapServer"),m.push(new ol.layer.Tile({extent:g.extent,source:new ol.source.TileArcGISRest(u)}))):"xyz"===p.type?(z.isArray(p.url)?(z.each(p.url,function(e,t){d.push(t.replace(/\${/g,"{"))}),u.urls=d):u.url=p.url.replace(/\${/g,"{"),m.push(new ol.layer.Tile({source:new ol.source.XYZ(u)}))):"osm"===p.type?m.push(new ol.layer.Tile({source:new ol.source.OSM({attributions:[ol.source.OSM.ATTRIBUTION]})})):"mapquest"===p.type&&m.push(new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"})}));else{for(a=ol.proj.get("EPSG:3978"),o=[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215],r=5,260<(i=this.mapDiv.width())&&i<=500?r=1:500<i&&i<=725?r=2:725<i&&i<=1175?r=3:1175<i&&i<=2300&&(r=4),l=r-1;-1!==l;l-=1)o.shift();for(n=new Array(o.length),t=0;t<o.length;++t)n[t]=r+t;g={extent:[-275e4,-9e5,36e5,463e4],resolutions:o,projection:a},m.push(new ol.layer.Tile({source:new ol.source.WMTS({attributions:[new ol.Attribution({html:"<a href='"+B.attribLink+"'>"+B.attribTitle+"</a>"})],url:B.baseMapURL,layer:B.baseMapTitle,matrixSet:B.baseMapMatrixSet,projection:a,tileGrid:new ol.tilegrid.WMTS({extent:[-275e4,-9e5,36e5,463e4],origin:[-34655800,3931e4],resolutions:o,matrixIds:n}),style:"default"})}))}for(var h=m.length-1;-1!==h;h-=1)s.map.addLayer(m[h]);return function(e){var t,a={};for(t in e)e.hasOwnProperty(t)&&null!==e[t]&&(a[t]=e[t]);return a}(g)},I.prototype.addToLegend=function(){var e,t,a,o,i,r,l=this,n=this.map.legend.target;0===(e=n.find("fieldset")).length&&(e=z("<fieldset name='legend'><legend class='wb-inv'>"+B.toggleLayer+"</legend></fieldset>").appendTo(n)),a=this.isVisibile?"checked='checked'":"",0===(t=n.find("ul.geomap-lgnd")).length&&(t=z("<ul class='list-unstyled geomap-lgnd'></ul>").appendTo(e)),o=z("<input type='checkbox' id='cb_"+this.id+"' class='geomap-lgnd-cbx' value='"+this.id+"' "+a+" data-map='"+this.map.id+"' data-layer='"+this.id+"' />"),l.observeVisibility(function(e){z("#sb_"+l.id).toggle(e),l.map.legend.refresh(),o.get(0).checked=e}),o.change(function(){l.isVisible=z(this).is(":checked")}),i=z("<label>",{for:"cb_"+this.id,text:this.settings.title}).prepend(o),r=z("<li class='checkbox geomap-lgnd-layer'>").append(i,"<div id='sb_"+this.id+"'></div>"),t.append(r),this.settings.options&&this.settings.options.legendUrl?z("#sb_"+this.id).append("<img src='"+this.settings.options.legendUrl+"' alt='"+B.geoLgndGrphc+"'/>"):this.settings.options&&this.settings.options.legendHTML?z("#sb_"+this.id).append(this.settings.options.legendHTML):"wms"!==this.settings.type&&this.map.legend.symbolize(this)},v.prototype.addTabularData=function(){var e,t,a,o,i,r,l,n,s,p,c,g,d,u,m,h,y,b,f,v,w,x,S,k,C,O,T,P,E,L="<th><span class='wb-inv'>"+B.zoomFeature+"</span></th>",A="<th><span class='wb-inv'>"+B.select+"</span></th>",N=new ol.format.WKT,F=/<\/?[^>]+>/gi,M=/\W/g;for(C=this.settings.tables.length-1;-1!==C;C-=1)if(t=D.getElementById(this.settings.tables[C].id)){for(e=z(t).wrap("<div data-layer='"+this.settings.tables[C].id+"' class='geomap-table-wrapper'></div>"),a=this.settings.tables[C],o=[],i=[],l=t.getElementsByTagName("th"),p=(s=t.getElementsByTagName("tr")).length,c=this.settings.useMapControls,e.hasClass("wb-tables")&&void 0===e.attr("data-wb-tables")&&e.attr("data-wb-tables",'{ "order": [], "columnDefs": [ { "targets": [ 0, '+(l.length+1)+' ], "orderable": false } ] }'),O=!1!==this.settings.tables[C].visible,n=l.length-1;-1!==n;n-=1)i[n]=l[n].innerHTML.replace(F,"");for(r=e.find("thead tr"),a.zoom&&c&&r.append(L),r.prepend(A),P=G(),T=void 0===a.style?{strokeColor:P.stroke,fillColor:P.fill}:a.style,p=s.length-1;-1!==p;p-=1){for(g={},u=(d=s[p]).getAttribute("data-type"),y=d.getElementsByTagName("td"),S=0;S<y.length;S+=1)(v=(h=y[S]).getElementsByTagName("script")[0])&&v.parentNode.removeChild(v),g[i[S]]=h.innerHTML;if(null!==u){if("bbox"===u){for(w=d.getAttribute("data-geometry").split(","),x="",k=(m=_(w[0],w[1],w[2],w[3])).length-1;-1!==k;k-=1)x+=m[k].getCoordinates()[0]+" "+m[k].getCoordinates()[1]+", ";f="POLYGON (("+(x=x.slice(0,-2))+"))"}else"wkt"===u&&-1!==(f=d.getAttribute("data-geometry")).indexOf("POINT")&&(f=f.replace(",",""));(b=N.readFeature(f,{dataProjection:"EPSG:4326",featureProjection:this.map.getView().getProjection()})).setId(R()),b.layerId=a.id,b.layerTitle=e.attr("aria-label"),a.tooltips&&(b.tooltip=a.tooltipText?g[a.tooltipText]:g[Object.keys(g)[0]]),d.setAttribute("id",b.getId().replace(M,"_")),z(d).html(j(this,b)+d.innerHTML+(c&&a.zoom?V(this,b):"")),b.attributes=g,o.push(b)}}E=new I(this,{tableId:e.attr("id"),type:"wkt",visible:O,datatable:a.datatable,popupsInfo:a.popupsInfo,popups:a.popups,tooltips:a.tooltips,tooltipText:a.tooltipText,name:a.id,title:e.attr("aria-label"),features:o,style:T}),this.mapLayers.push(E)}},v.prototype.addMapLayers=function(){var e,a,o=this;o.addTabularData(),z.each(o.settings.overlays,function(e,t){a=new I(o,t),o.mapLayers.push(a)}),(e=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba( 255, 0, 20, 0.1 )"}),stroke:new ol.style.Stroke({color:"#ff0033",width:2}),image:new ol.style.RegularShape({fill:new ol.style.Fill({color:"#ff0033"}),stroke:new ol.style.Stroke({color:"#ff0033",width:5}),points:4,radius:10,radius2:0,angle:0})})})).id="locLayer",o.map.addLayer(e);for(var t=o.mapLayers.length-1;-1!==t;t-=1)o.mapLayers[t].layer&&o.map.addLayer(o.mapLayers[t].layer)},I.prototype.populateDataTable=function(){if(this.settings.accessible){var e,t=this,a=t.settings.attributes,o=function(){var e=0;for(var t in a)a.hasOwnProperty(t)&&(e+=1);return e}(),i=z("<table class='table' aria-label='"+t.settings.title+"' id='"+t.id+"'><caption>"+t.settings.caption+"</caption></table>"),r="<th><span class='wb-inv'>"+B.select+"</span></th>",l="",n=t.layer.getSource().getFeatures();for(e in t.settings.datatable?(i.addClass("wb-tables"),i.attr("data-wb-tables",'{ "order": [], "columnDefs": [ { "targets": [ 0, '+(o+1)+' ], "orderable": false } ] }')):i.addClass("table-condensed"),a)a.hasOwnProperty(e)&&(r+="<th>"+(a[e].alias?a[e].alias:a[e])+"</th>");r="<thead><tr>"+r+(t.map.settings.useMapControls&&t.settings.zoom?"<th><span class='wb-inv'>"+B.zoomFeature+"</span></th>":"")+"</tr></thead>";for(var s=0;s<n.length;s+=1){for(e in l+="<tr>"+j(t,n[s]),a=n[s].attributes)a.hasOwnProperty(e)&&(l+="<td>"+a[e]+"</td>");l+=t.map.settings.useMapControls&&t.settings.zoom?V(t.map,n[s]):""}return i.append(r,"<tbody>"+l+"</tbody>"),z("div[ data-layer='"+t.id+"'].geomap-table-wrapper").append(i),t.map,z(".wb-tables").trigger("wb-init.wb-tables"),i}},I.prototype.createOLLayer=function(){var e,f,a,l,o,n,s,v=this,w=v.settings.attributes;if("wms"===v.settings.type){var t=function(e){var t,a={};for(t in e)e.hasOwnProperty(t)&&"type"!==t&&"caption"!==t&&"url"!==t&&"title"!==t&&(a[t]=e[t]);return a}(v.settings),i=t.options.opacity?t.options.opacity:1;f=new ol.layer.Image({opacity:i,visible:v.settings.visible,source:new ol.source.ImageWMS({url:v.settings.url,params:t})}),v.settings.accessible=!1}else if("wkt"===v.settings.type)a=new g,f=new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({features:v.settings.features}),style:a.createStyleFunction(v.settings.style,v.settings.featureType)}),v.settings.accessible=!1;else if("kml"===v.settings.type){var r=!v.settings.style;a=new g,e=G(),f=new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:v.settings.url,format:new ol.format.KML({extractStyles:r})})}),void 0===v.settings.style&&(v.settings.style={strokeColor:e.stroke,fillColor:e.fill}),f.getSource().once("addfeature",function(e){if(o=e.feature.getGeometry().getType(),!r){var t=a.createStyleFunction(v.settings.style,o);f.setStyle(t)}}),s=f.getSource(),n=s.on("change",function(){if("ready"===s.getState()){s.unByKey(n);for(var e=this.getFeatures(),t=0,a=e.length;t<a;t+=1){var o=e[t];if(v.settings.style.select){v.settings.style.select.type="select";var i=(new g).createStyleFunction(v.settings.style.select,o.getGeometry().getType());o.selectStyle=i}for(var r in o.setId(R()),o.layerId=f.id,o.layerTitle=f.title,l={},w)w.hasOwnProperty(r)&&(l[w[r]]=o.getProperties()[r]);o.attributes=l,v.settings.tooltips&&(o.tooltip=v.settings.tooltipText?l[v.settings.tooltipText]:l[Object.keys(l)[0]])}v.populateDataTable(),v.map.legend.symbolize(v)}},s)}else if("json"===v.settings.type){var x=new ol.source.Vector;a=new g,e=G(),void 0===v.settings.style&&(v.settings.style={strokeColor:e.stroke,fillColor:e.fill}),f=v.settings.cluster?new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Cluster({distance:40,source:x})}):new ol.layer.Vector({visible:v.settings.visible,source:x}),x.once("addfeature",function(){f.setStyle(a.createStyleFunction(v.settings.style,o))});z.getJSON(v.settings.url,v.settings.params,function(e){var t,a,o,i,r,l,n,s,p,c,g=v.settings.root,d=e[g]?e[g]:e.features?e.features:e;for(d instanceof Array==!1&&(d=z.map(d,function(e){return e})),s=0,p=d.length;s<p;s+=1)if((o=d[s])[n=n||F(o)]){if(i=o[n].coordinates[0],"Polygon"===o[n].type&&5===i.length){for(var u=[],m=0,h=(a=_(i[1][0],i[1][1],i[3][0],i[3][1])).length;m<h;m+=1){var y=a[m];u.push(y.getCoordinates())}r=new ol.geom.Polygon([u])}else"Point"===o[n].type?r=new ol.geom.Point([o[n].coordinates[1],o[n].coordinates[0]]):"LineString"===o[n].type&&(r=new ol.geom.LineString(o[n].coordinates));for(var b in l=r.transform("EPSG:4326",v.map.map.getView().getProjection()),t={},w)c=null,w.hasOwnProperty(b)&&((c=w[b].path)?t[w[b].alias]=o[b]?o[b][c]:"":t[w[b]]=o[b]?o[b]:"");(o=new ol.Feature).setId(R()),o.layerId=f.id,o.layerTitle=f.title,o.attributes=t,o.setGeometry(l),x.addFeature(o),v.settings.tooltips&&(o.tooltip=v.settings.tooltipText?t[v.settings.tooltipText]:t[Object.keys(t)[0]])}v.populateDataTable(),v.map.legend.symbolize(v)})}else if("geojson"===v.settings.type||"esrijson"===v.settings.type||"topojson"===v.settings.type){var p;a=new g,e=G(),void 0===v.settings.style&&(v.settings.style={strokeColor:e.stroke,fillColor:e.fill}),p=v.settings.params?v.settings.url+"?"+z.param(v.settings.params):v.settings.url,(f="geojson"===v.settings.type?new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:p,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox})}):"topojson"===v.settings.type?new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:p,format:new ol.format.TopoJSON})}):new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:p,format:new ol.format.EsriJSON,strategy:ol.loadingstrategy.bbox})})).getSource().once("addfeature",function(e){o=e.feature.getGeometry().getType();var t=a.createStyleFunction(v.settings.style,o);f.setStyle(t)}),s=f.getSource(),n=s.on("change",function(){if("ready"===s.getState()){s.unByKey(n);for(var e=this.getFeatures(),t=0,a=e.length;t<a;t+=1){var o=e[t];for(var i in o.setId(R()),o.layerId=f.id,o.layerTitle=f.title,l={},w)w.hasOwnProperty(i)&&(l[w[i]]=o.getProperties()[i]);o.attributes=l,v.settings.tooltips&&(o.tooltip=v.settings.tooltipText?l[v.settings.tooltipText]:l[Object.keys(l)[0]])}v.populateDataTable(),v.map.legend.symbolize(v)}},s)}return f?(f.id=v.id,f.title=v.settings.title,f.datatable=v.settings.datatable,f.popupsInfo=v.settings.popupsInfo,f.popups=v.settings.popups,f):null},v.prototype.loadControls=function(){var e,t,a,o,i=this,r=i.map,l=!1;if((o=new ol.interaction.Select({layers:i.layers})).getFeatures().on("remove",function(e){var t=e.element;t.setStyle(null),z("#cb_"+t.getId()).prop("checked",!1).closest("tr").removeClass("active")}),o.getFeatures().on("add",function(e){var t=e.element;t.selectStyle&&t.setStyle(t.selectStyle),z("#cb_"+t.getId()).prop("checked",!0).closest("tr").addClass("active")}),o.on("select",function(e){var t=e.selected?e.selected:this.getFeatures();t&&0<t.length&&void 0!==t[0].layerTitle&&(l=N(this.getMap(),t[0].layerId).popups,t[0].layerTitle=this.getLayer(e.selected[0]).title,l&&s(0,t[0],r)),t&&0===t.length&&s(0,null,r)},o),r.getInteractions().extend([o]),i.settings.useMapControls){var n=D.createElement("span");n.className="glyphicon glyphicon-home",e=new ol.control.ZoomToExtent({extent:r.getView().calculateExtent(r.getSize()),label:n}),r.addControl(e),e.element.setAttribute("aria-label",B.zoomworld),e.element.setAttribute("title",B.zoomworld),i.settings.useMousePosition&&(t=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",undefinedHTML:""}),r.addControl(t),t.element.setAttribute("aria-label",B.mouseposition),t.element.setAttribute("title",B.mouseposition)),i.settings.useScaleLine&&(a=new ol.control.ScaleLine,r.addControl(a),a.element.setAttribute("aria-label",B.scaleline),a.element.setAttribute("title",B.scaleline))}i.settings.useGeocoder&&new d(i),i.settings.useAOI&&new p(i),i.settings.useGeolocation&&i.map.addControl(new u({projection:i.map.getView().getProjection()}))},v.prototype.createPopup=function(){var e,t,a;a=z("<div id='popup-"+this.mapDiv.attr("id")+"' class='ol-popup'></div>"),e=z("<a href='#' title='"+B.dismiss+"' class='ol-popup-closer' role='button'>&#xd7;<span class='wb-inv'>"+B.dismiss+"</span></a>"),a.append(e,"<div class='popup-content'></div>"),z("#"+this.mapDiv.attr("id")).append(a),t=new ol.Overlay({element:D.getElementById("popup-"+this.mapDiv.attr("id")),autoPan:!0,autoPanAnimation:{duration:250}}),e.on("click",function(e){return e.preventDefault(),t.setPosition(void 0),this.blur(),!1}),this.map.addOverlay(t)},v.prototype.accessibilize=function(){var e=this,t=e.mapDiv.find(".ol-zoom-in"),a=e.mapDiv.find(".ol-zoom-out");t.attr("aria-label",B.zoomin),t.attr("title",B.zoomin),a.attr("aria-label",B.zoomout),a.attr("title",B.zoomout),e.mapDiv.attr({tabindex:"0","data-map":e.id}),e.mapDiv.attr({role:"dialog","aria-label":B.ariaMap}),e.settings.useMapControls&&new o(e)},v.prototype.zoomAOI=function(e,t,a,o){var i,r,l,n=this.map,s=n.getView(),p="string"==typeof e;if(!p||e.length){if(p&&null!==e.substring(0,1).match(/[a-z]/gi)){l=(new ol.format.WKT).readFeature(e,{dataProjection:"EPSG:4326",featureProjection:s.getProjection()})}else{if(!t&&p){if(4!==(i=e.split(" ")).length)throw"4 cardinal point must be provided";e=i[0],t=i[1],a=i[2],o=i[3]}else if(!t||!a||!o)throw"Cardinal point must be provided";i=[parseFloat(o),parseFloat(a),parseFloat(t),parseFloat(e)],l=A(this,i,!0)}r=l.getGeometry().getExtent(),s.fit(r,n.getSize())}else s.setZoom(s.getMaxZoom)},v.prototype.showLayer=function(e,t){var a,o,i,r=[],l=this.mapLayers,n=l.length;for(t=!!t,Array.isArray(e)?r=e:r.push(e),a=0;a!==n;a+=1)i=(o=l[a]).layer.title,e&&-1===r.indexOf(i)?i&&(o.isVisible=!t):o.isVisible=t},i.prototype.symbolize=function(e){if(e.layer){var t,a,o,i,r,l,n,s,p=e.settings.style,c=e.id,g=e.layer.getSource().getFeatures()[0],d=[],u="",m="";if(void 0!==p&&p.rule){if(a=p.rule.length)for(r=0;r!==a;r+=1){if(t=(n=p.rule[r]).filter,o=n.init,m="",s="ls_"+c+"_"+r,t&&!n.name)if(t.name)m=t.name;else switch(t){case"EQUAL_TO":m=n.field+" = "+n.value[0];break;case"GREATER_THAN":m=n.field+" > "+n.value[0];break;case"LESS_THAN":m=n.field+" < "+n.value[0];break;case"BETWEEN":m=n.field+" "+n.value[0]+" - "+n.value[1]}else n&&n.name&&(m=n.name);u+="<li><div class='geomap-legend-element'><div id='"+s+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+m+"</small></span></div></li>",d.push({id:s,feature:g,symbolizer:o})}}else if(void 0!==p&&"unique"===p.type)for(var h in r=0,p.init)u+="<li><div class='geomap-legend-element'><div id='"+(s="ls_"+c+"_"+r)+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+(m=(o=p.init[h]).name?o.name:h)+"</small></span></div></li>",d.push({id:s,feature:g,symbolizer:o}),r+=1;else void 0!==p&&"symbol"===p.type?u+="<li><div class='geomap-legend-element'><div id='"+(s="ls_"+c+"_0")+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+(m=(o=p.init).name?o.name:"")+"</small></span></div></li>":(s="ls_"+c+"_0",o={fillColor:p.fillColor,strokeColor:p.strokeColor,strokeWidth:p.strokeWidth,strokeDash:p.strokeDash},u+="<li><div class='geomap-legend-element'><div id='"+s+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+m+"</small></span></div></li>"),d.push({id:s,feature:g,symbolizer:o});for(z("#sb_"+c).html("<ul class='list-unstyled'>"+u+"</ul>"),i=0,l=d.length;i!==l;i+=1){var y=d[i];this.getSymbol(y.id,y.feature,y.symbolizer)}}},i.prototype.getSymbol=function(e,t,a){var o,i,r,l,n=G(),s=t&&t.getGeometry()?t.getGeometry().getType():"Polygon",p=a.fillOpacity?a.fillOpacity:a.graphicOpacity?a.graphicOpacity:1,c=a.fillColor?P(a.fillColor,p):n.transparent,g=a.pointRadius?a.pointRadius:5,d=a.strokeColor?P(a.strokeColor):n.transparent,u=a.strokeWidth?a.strokeWidth:1,m=a.strokeDash?a.strokeDash:[1,0],h=a.externalGraphic?a.externalGraphic:null,y=a.graphicName?a.graphicName:null,b=a.graphicHeight?a.graphicHeight:30,f=a.graphicWidth?a.graphicWidth:30,v=b<2*g?2*g:b,w=f<2*g?2*g:f;switch(s){case"Polygon":o=new ol.Feature({geometry:new ol.geom.Polygon([[[-10,-7],[10,-7],[10,7],[-10,7]]])}),l=O({fill:new ol.style.Fill({color:c}),stroke:new ol.style.Stroke({color:d,width:u,lineDash:m})}),o.setStyle(l);break;case"Point":o=new ol.Feature({geometry:new ol.geom.Point([0,0])}),l=y?S({symbol:y,fill:new ol.style.Fill({color:c}),stroke:new ol.style.Stroke({color:d,lineDash:m}),radius:g}):h?k({src:h,opacity:p,size:[f,b]}):C({radius:g,fill:new ol.style.Fill({color:c}),stroke:new ol.style.Stroke({color:d,width:u,lineDash:m})}),o.setStyle(l);break;case"LineString":o=new ol.Feature({geometry:new ol.geom.LineString([[-9,-4],[-4,4],[4,-4],[9,4]])}),l=T({stroke:new ol.style.Stroke({color:d,width:u,lineDash:m})}),o.setStyle(l);break;default:o=new ol.Feature({geometry:new ol.geom.Polygon([[[-10,-7],[10,-7],[10,7],[-10,7]]])}),l=O({fill:new ol.style.Fill({color:c}),stroke:new ol.style.Stroke({color:d,width:u,lineDash:m})}),o.setStyle(l)}(i=new ol.Map({controls:[],interactions:[],layers:[new ol.layer.Vector({source:new ol.source.Vector})]}))&&(this.symbolMapArray.push(i),(r=i.getLayers().item(0).getSource()).clear(),r.addFeature(o)),i.setTarget(e),function(e,t,a,o,i){var r,l,n,s,p,c,g,d=a.getGeometry().getExtent(),u=ol.extent.getWidth(d),m=ol.extent.getHeight(d),h=z("#"+e);p=(p=1)||(Math.max(u/o||0,m/i||0)||1),t.setView(new ol.View({minResolution:p,maxResolution:p,projection:new ol.proj.Projection({code:"",units:"pixels"})})),r=(g=Math.max(o,u/p))*p/2,l=(c=Math.max(i,m/p))*p/2,n=[(s=ol.extent.getCenter(d))[0]-r,s[1]-l,s[0]+r,s[1]+l],h.width(Math.round(g)),h.height(Math.round(c)),t.updateSize(),t.getView().fit(n,t.getSize())}(e,i,o,w,v)},i.prototype.refresh=function(){var e,t;if(0!==this.symbolMapArray.length)for(e=this.symbolMapArray.length-1;-1!==e;e-=1)t=this.symbolMapArray[e],z("#"+t.getTarget()).is(":visible")&&t.updateSize()},ol.inherits(u,ol.control.Control),ol.inherits(o,ol.control.Control),ol.inherits(d,ol.control.Control),l.doc.on("submit",".wb-geomap-filter",function(e){e.preventDefault();var t=z(this),o=D.getElementById(t.data("bind-to")).geomap;t.find("select[data-filter]").each(function(){var e=z(this),t=e.find("option:selected").val(),a=e.attr("data-filter");"aoi"===a&&o.zoomAOI(t),"layer"===a&&o.showLayer(t,!0)})}),l.doc.on("click",".wb-geomap-filter [type=reset]",function(){var e=z(this.form),t=D.getElementById(e.data("bind-to")).geomap,a=t.map,o=a.getView();a.getView().fit(o.calculateExtent(a.getSize()),a.getSize()),e.find("select[data-filter=layer] option").each(function(){this.defaultSelected&&t.showLayer(this.value,!0)}),e.find("select[data-filter=aoi] option").each(function(){this.defaultSelected&&t.zoomAOI(this.value)})})}(jQuery,window,document,wb);